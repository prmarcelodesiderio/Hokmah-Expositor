<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hokmah Expositor — Plano Free</title>

    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        margin: 0;
        padding: 0;
        background: #f5f5f5;
      }

      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 2rem;
        background: #ffffff;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
      }

      header h1 {
        margin: 0;
        font-size: 1.3rem;
      }

      .header-right {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .plan-badge {
        padding: 0.4rem 0.9rem;
        border-radius: 999px;
        border: 1px solid #ddd;
        background: #fafafa;
        font-size: 0.9rem;
      }

      .page {
        max-width: 900px;
        margin: 2.5rem auto;
        padding: 0 1rem;
      }

      .app-section {
        max-width: 900px;
        margin: 1.5rem auto;
        padding: 1.5rem;
        background: #ffffff;
        border-radius: 12px;
        border: 1px solid #e0e0e0;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      }

      .app-section .hint {
        font-size: 0.9rem;
        color: #555;
        margin-top: 1rem;
      }

      .app-section button {
        border: none;
        border-radius: 8px;
        padding: 0.7rem 1.2rem;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        background: #2e7d32;
        color: white;
        transition: background 0.15s ease;
      }

      .app-section button:hover {
        background: #1b5e20;
      }

      #app-free button {
        background: #3949ab;
      }
      #app-free button:hover {
        background: #283593;
      }

      .card {
        background: #ffffff;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.06);
        border: 1px solid #e0e0e0;
      }

      h2 {
        margin-top: 0;
        font-size: 1.4rem;
      }

      p {
        line-height: 1.5;
      }

      #upgrade-btn {
        display: inline-block;
        border: none;
        border-radius: 999px;
        padding: 0.75rem 1.8rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        color: white;
        background: #1e88e5;
        box-shadow: 0 2px 6px rgba(30, 136, 229, 0.35);
        transition: background 0.15s ease, transform 0.1s ease,
          box-shadow 0.1s ease;
      }

      #upgrade-btn:hover {
        background: #1565c0;
        transform: translateY(-1px);
        box-shadow: 0 4px 10px rgba(30, 136, 229, 0.4);
      }

      #upgrade-btn:disabled {
        background: #b0bec5;
        box-shadow: none;
        cursor: default;
        transform: none;
      }

      #upgrade-status {
        margin-top: 0.75rem;
        font-size: 0.9rem;
        color: #555;
      }

      .status-error {
        color: #c62828;
        font-weight: 500;
      }

      .status-ok {
        color: #2e7d32;
        font-weight: 500;
      }

      .premium-box {
        display: none; /* script controla depois */
        color: #1b5e20;
        font-size: 0.95rem;
      }

      /* ===== INÍCIO DA SUBSTITUIÇÃO ===== */
      .landing-section {
        max-width: 1100px;
        margin: 2.5rem auto 1.5rem;
        padding: 0 1rem;
      }

      .landing-card {
        background: #ffffff;
        border-radius: 20px;
        padding: 2.5rem 2.75rem;
        border: 1px solid #e0e7ff;
        box-shadow: 0 18px 40px rgba(15, 23, 42, 0.08);
      }

      .landing-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.3rem 0.9rem;
        border-radius: 999px;
        background: #e3f2fd;
        color: #1565c0;
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        margin-bottom: 0.9rem;
      }

      .hero-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 2.5rem;
        align-items: flex-start;
      }

      .hero-main,
      .hero-side {
        flex: 1 1 280px;
      }

      .hero-title {
        font-size: 2rem;
        margin: 0 0 0.75rem;
      }

      .hero-subtitle {
        font-size: 1rem;
        color: #4b5563;
        margin: 0 0 1rem;
      }

      .hero-list {
        margin: 0 0 1.4rem;
        padding-left: 1.2rem;
        color: #111827;
      }

      .hero-list li {
        margin-bottom: 0.35rem;
      }

      .hero-cta {
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
      }

      .hero-note {
        font-size: 0.9rem;
        color: #4b5563;
      }

      .hero-side-title {
        font-size: 1.1rem;
        margin: 0 0 0.5rem;
      }

      .hero-side p {
        font-size: 0.95rem;
        color: #4b5563;
        margin: 0 0 0.8rem;
      }

      .hero-side-list {
        margin: 0;
        padding-left: 1.1rem;
        font-size: 0.95rem;
        color: #111827;
      }

      .hero-side-list li {
        margin-bottom: 0.35rem;
      }

      .feature-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
        gap: 1.25rem;
        margin-top: 2rem;
      }

      .feature-card {
        border-radius: 14px;
        border: 1px solid #e5e7eb;
        background: #f9fafb;
        padding: 1rem 1.2rem;
      }

      .feature-title {
        font-size: 1rem;
        margin: 0 0 0.4rem;
      }

      .feature-card p {
        font-size: 0.9rem;
        margin: 0;
        color: #4b5563;
      }

      .notice-box {
        margin-top: 2rem;
        border-radius: 12px;
        border: 1px solid #fde68a;
        background: #fffbeb;
        padding: 1rem 1.2rem;
        font-size: 0.92rem;
        color: #7c2d12;
      }

      .notice-box strong {
        display: block;
        margin-bottom: 0.3rem;
      }

      .btn {
        border: none;
        border-radius: 999px;
        padding: 0.8rem 1.9rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        color: white;
        background: #2e7d32;
        box-shadow: 0 10px 24px rgba(34, 197, 94, 0.35);
      }

      .btn:hover {
        background: #1b5e20;
      }

      @media (max-width: 640px) {
        .landing-card {
          padding: 1.8rem 1.5rem;
        }

        .hero-title {
          font-size: 1.6rem;
        }
      }
      /* ===== FIM DA SUBSTITUIÇÃO ===== */

      .form-group {
        margin-bottom: 0.9rem;
      }

      .form-group label {
        display: block;
        font-size: 0.9rem;
        margin-bottom: 0.25rem;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 0.45rem 0.5rem;
        border-radius: 6px;
        border: 1px solid #ccc;
        font: inherit;
      }

      .outline-result {
        background: #111827;
        color: #e5e7eb;
        padding: 1rem;
        border-radius: 8px;
        max-height: 400px;
        overflow: auto;
        white-space: pre-wrap;
        font-size: 0.9rem;
      }
    </style>
  </head>

  <body>
    <header>
      <h1>Hokmah Expositor</h1>
      <div class="header-right">
        <div id="plan-label" class="plan-badge">Plano: Free</div>

        <form
          id="upgrade-form"
          action="/create-checkout-session"
          method="POST"
          style="margin: 0;"
        >
          <button id="upgrade-btn" type="submit">Assinar Premium</button>
        </form>
      </div>
    </header>

    <section id="landing" class="landing-section">
      <div class="landing-card">
        <div class="hero-grid">
          <div class="hero-main">
            <div class="landing-badge">
              Para pastores, pregadores e líderes
            </div>

            <h1 class="hero-title">
              Hokmah Expositor — IA a serviço da pregação cristocêntrica
            </h1>

            <p class="hero-subtitle">
              Um laboratório de esboços pensado para pastores que amam a
              Escritura, prezam pela teologia reformada e precisam organizar
              melhor o tempo entre estudo, família e cuidado da igreja.
            </p>

            <ul class="hero-list">
              <li>Esboços expositivos, temáticos, biográficos e textuais.</li>
              <li>
                Ênfase pastoral reformada: Cristo ao centro, graça soberana e
                <em>Sola Scriptura</em>.
              </li>
              <li>
                Divisões claras, aplicações pastorais e sugestões de citações e
                ilustrações.
              </li>
            </ul>

            <div class="hero-cta">
              <button type="button" class="btn" onclick="startFree()">
                Comece grátis
              </button>
              <p class="hero-note">
                Comece agora no <strong>plano Free</strong> com
                <strong>10 esboços por mês</strong> neste navegador. Sem cartão,
                sem compromisso. Quando desejar, você pode migrar para o
                <strong>Plano Premium</strong> com uso ilimitado.
              </p>
            </div>
          </div>

          <div class="hero-side">
            <h3 class="hero-side-title">
              Mais tempo para o que só você pode fazer
            </h3>
            <p>
              Nenhum aplicativo visita enfermos, aconselha famílias ou ora com as
              ovelhas. O Hokmah existe para aliviar a parte técnica do esboço e
              devolver horas preciosas ao seu ministério.
            </p>
            <ul class="hero-side-list">
              <li>
                Ganhe tempo na organização de ideias e estrutura do sermão.
              </li>
              <li>
                Invista mais em oração, estudo profundo e discipulado pessoal.
              </li>
              <li>Proteja espaços de descanso e tempo com sua família.</li>
            </ul>
          </div>
        </div>

        <div class="feature-grid">
          <div class="feature-card">
            <h4 class="feature-title">Fundamentado na teologia reformada</h4>
            <p>
              Configurado para refletir uma cosmovisão reformada: centralidade
              de Cristo, soberania de Deus, suficiência das Escrituras e
              compromisso confessional histórico.
            </p>
          </div>

          <div class="feature-card">
            <h4 class="feature-title">Focado no pastor local</h4>
            <p>
              Pensado para quem prega semana após semana. Estruturas clássicas de
              homilética, auxílio para séries de sermões, cultos ocasionais e
              estudos bíblicos.
            </p>
          </div>

          <div class="feature-card">
            <h4 class="feature-title">Ferramenta, não substituto</h4>
            <p>
              O Hokmah organiza ideias, sugere caminhos e ajuda na clareza do
              sermão, mas não prega por você. Ele é um servo, não um atalho
              espiritual.
            </p>
          </div>
        </div>

        <div class="notice-box">
          <strong>Aviso pastoral importante</strong>
          <p>
            O Hokmah Expositor <strong>não substitui</strong> o estudo diligente
            da Palavra nem a vida de oração. Nenhuma inteligência artificial pode
            ocupar o lugar da ação do Espírito Santo, da exegese séria do texto e
            da devoção particular do pregador. Use esta ferramenta para servir
            melhor a Cristo e à Sua igreja, nunca para fugir da
            responsabilidade de buscar o Senhor nas Escrituras.
          </p>
        </div>
      </div>
    </section>

    <div id="app-container">
      <section id="app-free" class="app-section">
        <h2>Gerador de Esboços – Plano Free</h2>
        <p>
          No plano gratuito você pode gerar até
          <strong>10 esboços por mês</strong>
          neste navegador. Use para testar o Hokmah Expositor.
        </p>

        <form id="free-form" onsubmit="return false;">
          <div class="form-group">
            <label for="free-title">Título / Tema do sermão</label>
            <input
              type="text"
              id="free-title"
              placeholder="Ex.: A graça que nos sustenta"
            />
          </div>

          <div class="form-group">
            <label for="free-text">Texto bíblico principal</label>
            <input
              type="text"
              id="free-text"
              placeholder="Ex.: 2 Coríntios 12:7-10"
            />
          </div>

          <div class="form-group">
            <label for="free-method">Método de pregação</label>
            <select id="free-method">
              <option value="expositivo">Expositivo</option>
              <option value="tematico">Temático</option>
              <option value="biografico">Biográfico</option>
              <option value="textual">Textual</option>
            </select>
          </div>

          <div class="form-group">
            <label for="free-emphasis">Ênfase pastoral</label>
            <select id="free-emphasis">
              <option value="pastoral">Pastoral</option>
              <option value="doutrinaria">Doutrinária</option>
              <option value="exortativa">Exortativa</option>
              <option value="evangelistica">Evangelística</option>
              <option value="admoestativa">Admoestativa</option>
              <option value="apologetica">Apologética</option>
            </select>
          </div>

          <button
            type="button"
            id="free-submit"
            onclick="handleGenerateFree();"
          >
            Gerar esboço (Free – conta para o limite mensal)
          </button>
        </form>

        <p class="hint">
          Dica: para geração <strong>ilimitada</strong> e recursos avançados,
          assine o plano Premium.
        </p>

        <h3>Resultado do esboço (Free)</h3>
        <pre id="free-result" class="outline-result"></pre>
      </section>

      <section id="app-premium" class="app-section">
        <h2>Laboratório de Sermões – Plano Premium</h2>
        <p>
          Aqui você tem geração <strong>ilimitada</strong> de esboços e estudos
          bíblicos, usando o motor do Hokmah Expositor integrado ao Gemini.
        </p>

        <div class="iframe-wrapper" style="margin-top: 1rem;">
          <iframe
            src="https://hokmah-expositor-gerador-de-esbo-os-de-serm-o-467345148998.us-west1.run.app"
            width="100%"
            height="900"
            style="border: none; border-radius: 8px; background: #ffffff;"
            loading="lazy"
          ></iframe>
        </div>
      </section>
    </div>

    <div class="page">
      <div class="card">
        <h2>Conteúdo grátis visível para todos.</h2>
        <p>
          Este é o plano gratuito do Hokmah Expositor. Para liberar os recursos
          Premium (mais geração de esboços, estudos bíblicos aprofundados,
          citações e ilustrações reformadas, etc.), faça sua assinatura abaixo.
        </p>

        <p id="upgrade-status"></p>

        <div class="premium-box" id="premium-extra-box">
          <strong>Você está no plano Premium.</strong><br />
          Agora você tem geração <strong>ilimitada</strong> de esboços e estudos,
          modelos avançados de estrutura, histórico salvo e outros recursos
          exclusivos.
        </div>
      </div>
    </div>

    <script>
      // ====== CONFIGURAÇÕES GERAIS ======
      const FREE_LIMIT_PER_MONTH = 10; // limite de esboços no plano Free
      const MAX_FREE_CHARS = 1500; // tamanho máx. do texto exibido no Free
      const API_URL = "https://SUA-URL-AQUI/sermon"; // TODO: ajustar depois para seu backend

      function getHokmahPlan() {
        const stored = localStorage.getItem("hokmah_plan"); // definido em sucesso.html
        return stored === "premium" ? "premium" : "free";
      }

      function getCurrentMonthKey() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, "0");
        return `${year}-${month}`;
      }

      async function callOutlineApi(payload) {
        const response = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        if (!response.ok) {
          throw new Error("Erro na API: " + response.status);
        }

        const data = await response.json();
        return data.outline || JSON.stringify(data, null, 2);
      }

      function setupUiByPlan() {
        const plan = getHokmahPlan();
        const hasStartedFree = localStorage.getItem("hokmah_started") === "yes";

        const planLabel = document.getElementById("plan-label");
        const appFree = document.getElementById("app-free");
        const appPremium = document.getElementById("app-premium");
        const landing = document.getElementById("landing");
        const appContainer = document.getElementById("app-container");
        const premiumBox = document.getElementById("premium-extra-box");

        if (planLabel) {
          planLabel.textContent =
            plan === "premium" ? "Plano: Premium" : "Plano: Free";
        }

        if (plan === "premium") {
          if (landing) landing.style.display = "none";
          if (appContainer) appContainer.style.display = "block";
          if (appPremium) appPremium.style.display = "block";
          if (appFree) appFree.style.display = "none";
          if (premiumBox) premiumBox.style.display = "block";
        } else {
          if (premiumBox) premiumBox.style.display = "none";

          if (!hasStartedFree) {
            if (landing) landing.style.display = "block";
            if (appContainer) appContainer.style.display = "none";
          } else {
            if (landing) landing.style.display = "none";
            if (appContainer) appContainer.style.display = "block";
          }
          if (appPremium) appPremium.style.display = "none";
          if (appFree) appFree.style.display = "block";
        }
      }

      function startFree() {
        localStorage.setItem("hokmah_started", "yes");
        setupUiByPlan();
      }

      async function handleGenerateFree() {
        const plan = getHokmahPlan();
        if (plan !== "free") {
          alert(
            "Este botão é para o plano Free. Se você é Premium, use a área Premium."
          );
          return;
        }

        const monthKey = getCurrentMonthKey();
        const storageKey = "hokmah_free_count_" + monthKey;
        let current = parseInt(localStorage.getItem(storageKey) || "0", 10);

        if (current >= FREE_LIMIT_PER_MONTH) {
          alert(
            "Você já atingiu o limite de " +
              FREE_LIMIT_PER_MONTH +
              " esboços neste mês no plano Free.\n" +
              "Assine o Plano Premium para ter geração ilimitada."
          );
          return;
        }

        const titleInput = document.getElementById("free-title");
        const textInput = document.getElementById("free-text");
        const methodSelect = document.getElementById("free-method");
        const emphasisSelect = document.getElementById("free-emphasis");
        const resultEl = document.getElementById("free-result");
        const button = document.getElementById("free-submit");

        const title = titleInput.value.trim();
        const text = textInput.value.trim();

        if (!title || !text) {
          alert(
            "Preencha pelo menos o título/tema e o texto bíblico principal."
          );
          return;
        }

        const payload = {
          plan: "free",
          title,
          biblicalText: text,
          method: methodSelect.value,
          emphasis: emphasisSelect.value,
        };

        button.disabled = true;
        resultEl.textContent = "Gerando seu esboço (plano Free)...";

        try {
          let outline = await callOutlineApi(payload);

          if (outline.length > MAX_FREE_CHARS) {
            outline =
              outline.slice(0, MAX_FREE_CHARS) +
              "\n\n[Versão resumida no plano Free. Assine o plano Premium para acessar o esboço completo.]";
          }

          current = current + 1;
          localStorage.setItem(storageKey, String(current));

          resultEl.textContent =
            "Esboço Free " +
            current +
            "/" +
            FREE_LIMIT_PER_MONTH +
            " neste mês:\n\n" +
            outline;
        } catch (err) {
          console.error(err);
          resultEl.textContent =
            "Ocorreu um erro ao gerar o esboço Free.\nTente novamente em alguns instantes.";
        } finally {
          button.disabled = false;
        }
      }

      async function handleGeneratePremium() {
        const plan = getHokmahPlan();
        if (plan !== "premium") {
          alert(
            "Este botão é para o plano Premium. Assine para liberar o uso ilimitado."
          );
          return;
        }

        const titleInput = document.getElementById("premium-title");
        const textInput = document.getElementById("premium-text");
        const methodSelect = document.getElementById("premium-method");
        const emphasisSelect = document.getElementById("premium-emphasis");
        const resultEl = document.getElementById("premium-result");
        const button = document.getElementById("premium-submit");

        const title = titleInput.value.trim();
        const text = textInput.value.trim();

        if (!title || !text) {
          alert(
            "Preencha pelo menos o título/tema e o texto bíblico principal."
          );
          return;
        }

        const payload = {
          plan: "premium",
          title,
          biblicalText: text,
          method: methodSelect.value,
          emphasis: emphasisSelect.value,
        };

        button.disabled = true;
        resultEl.textContent =
          "Gerando seu esboço (plano Premium, ilimitado)...";

        try {
          const outline = await callOutlineApi(payload);
          resultEl.textContent = outline;
        } catch (err) {
          console.error(err);
          resultEl.textContent =
            "Ocorreu um erro ao gerar o esboço Premium.\nTente novamente em alguns instantes.";
        } finally {
          button.disabled = false;
        }
      }

      window.addEventListener("load", setupUiByPlan);
    </script>
  </body>
</html>
